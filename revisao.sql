/* Avaliação III - Banco de Dados I
   Esquema que armazena informações sobre locais, hotéis, tipos de quarto, e tipos de diárias
   trabalhados por uma agência de viagens */

CREATE DATABASE bd_avaliacaoIII

USE bd_avaliacaoIII


CREATE TABLE TB_LOCAL (
  ID_LOCAL INT NOT NULL PRIMARY KEY,
  CIDADE VARCHAR(100) NOT NULL,
  ESTADO CHAR(2) NOT NULL
)

INSERT INTO TB_LOCAL VALUES (1, 'ARACAJU',	'SE')
INSERT INTO TB_LOCAL VALUES (2, 'SALVADOR',	'BA')
INSERT INTO TB_LOCAL VALUES (3, 'SAUÍPE',	'BA')


CREATE TABLE TB_HOTEL (
  ID_HOTEL INT NOT NULL PRIMARY KEY,
  NM_HOTEL VARCHAR(100) NOT NULL,
  ID_LOCAL INT NOT NULL
)

ALTER TABLE TB_HOTEL ADD CONSTRAINT FK_HOTEL_LOCAL FOREIGN KEY
(ID_LOCAL) REFERENCES TB_LOCAL (ID_LOCAL)

INSERT INTO TB_HOTEL VALUES (1, 'FIESTA HOTEL', 2)
INSERT INTO TB_HOTEL VALUES (2, 'CATUÇABA RESORT', 2)
INSERT INTO TB_HOTEL VALUES (3, 'PESTANA', 2)
INSERT INTO TB_HOTEL VALUES (4, 'ONDINA APART',2)

INSERT INTO TB_HOTEL VALUES (5, 'RADISON', 1)
INSERT INTO TB_HOTEL VALUES (6, 'AQUARIUS', 1)

INSERT INTO TB_HOTEL VALUES (7, 'COSTA DO SAUÍPE RESORT', 3)


CREATE TABLE TB_TIPO_QUARTO (
   ID_TIPO_QUARTO INT NOT NULL PRIMARY KEY,
   NM_TIPO_QUARTO VARCHAR(10) UNIQUE 
)

INSERT INTO TB_TIPO_QUARTO VALUES (1, 'SIMPLES')
INSERT INTO TB_TIPO_QUARTO VALUES (2, 'DUPLO')
INSERT INTO TB_TIPO_QUARTO VALUES (3, 'TRIPLO')


CREATE TABLE TB_HOTEL_DIARIAS (
   ID_DIARIA	  INT NOT NULL PRIMARY KEY, 
   ID_HOTEL	  INT NOT NULL REFERENCES TB_HOTEL (ID_HOTEL),
   ID_TIPO_QUARTO INT NOT NULL REFERENCES TB_TIPO_QUARTO(ID_TIPO_QUARTO),
   VALOR_DIARIA	  NUMERIC(10,2) NOT NULL,
   UNIQUE(ID_HOTEL, ID_TIPO_QUARTO)
)

INSERT INTO TB_HOTEL_DIARIAS VALUES(1,1,1,120.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(2,1,2,140.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(3,1,3,160.0)


INSERT INTO TB_HOTEL_DIARIAS VALUES(4,2,1,130.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(5,2,2,150.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(6,2,3,300.0)

INSERT INTO TB_HOTEL_DIARIAS VALUES(7,3,1,190.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(8,3,2,240.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(9,3,3,300.0)

INSERT INTO TB_HOTEL_DIARIAS VALUES(10,5,1,200.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(11,5,2,220.0)

INSERT INTO TB_HOTEL_DIARIAS VALUES(12,6,1,300.0)
INSERT INTO TB_HOTEL_DIARIAS VALUES(13,6,2,350.0)

INSERT INTO TB_HOTEL_DIARIAS VALUES(14,7,3,400.0)

------------------------------------------------------------------------------------------------------

SELECT LC.ESTADO, LC.CIDADE, HT.NM_HOTEL
FROM TB_LOCAL LC INNER JOIN TB_HOTEL HT
	ON(LC.ID_LOCAL = HT.ID_LOCAL)
ORDER BY LC.ESTADO, LC.CIDADE, HT.NM_HOTEL

------------------------------------------------------------------------------------------------------

SELECT HT.NM_HOTEL, LC.CIDADE, QT.NM_TIPO_QUARTO, DA.VALOR_DIARIA
FROM TB_TIPO_QUARTO QT INNER JOIN TB_HOTEL_DIARIAS DA
	ON (QT.ID_TIPO_QUARTO = DA.ID_TIPO_QUARTO)
	INNER JOIN TB_HOTEL HT
	ON (DA.ID_HOTEL = HT.ID_HOTEL)
	INNER JOIN TB_LOCAL LC
	ON (HT.ID_HOTEL = LC.ID_LOCAL)
WHERE QT.NM_TIPO_QUARTO = 'TRIPLO' AND LC.ESTADO = 'BA'

------------------------------------------------------------------------------------------------------

SELECT DISTINCT LC.CIDADE, COUNT(HT.ID_HOTEL)
FROM TB_LOCAL LC INNER JOIN TB_HOTEL HT
	ON (LC.ID_LOCAL = HT.ID_LOCAL)
GROUP BY LC.CIDADE
ORDER BY LC.CIDADE

------------------------------------------------------------------------------------------------------

SELECT AVG(DA.VALOR_DIARIA) AS 'MÉDIA DA DIÁRIA EM UM QUARTO DUPLO'
FROM TB_HOTEL_DIARIAS DA INNER JOIN TB_TIPO_QUARTO QT
	ON (DA.ID_TIPO_QUARTO = QT.ID_TIPO_QUARTO)
WHERE QT.NM_TIPO_QUARTO = 'DUPLO'

------------------------------------------------------------------------------------------------------

SELECT HT.NM_HOTEL, MAX(DA.VALOR_DIARIA) AS 'MAIOR  DIÁRIA POR HOTEL'
FROM TB_HOTEL HT INNER JOIN TB_HOTEL_DIARIAS DA
	ON (HT.ID_HOTEL = DA.ID_HOTEL)
	INNER JOIN TB_TIPO_QUARTO QT
	ON (QT.ID_TIPO_QUARTO = QT.ID_TIPO_QUARTO)
GROUP BY HT.NM_HOTEL

------------------------------------------------------------------------------------------------------

SELECT NM_HOTEL
FROM TB_HOTEL
WHERE ID_HOTEL NOT IN (
    SELECT ID_HOTEL
    FROM TB_HOTEL_DIARIAS
    WHERE ID_TIPO_QUARTO = 2
)